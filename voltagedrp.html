<!DOCTYPE html>

        #progress-bar-container {
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 0 0 4px 4px;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 0 0 4px 4px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="whiteboard-container">
        <div id="controls">
            <button id="play-btn">▶ Start Tutorial</button>
        </div>
        <div id="whiteboard">
            <svg id="animation-svg" viewBox="0 0 1600 900">
                <!-- All SVG elements will be dynamically created by JavaScript -->
            </svg>
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
        </div>
        <div id="voiceover-display">Click "Start Tutorial" to begin...</div>
    </div>

<script>
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.getElementById('animation-svg');
    const playBtn = document.getElementById('play-btn');
    const progressBar = document.getElementById('progress-bar');
    const voDisplay = document.getElementById('voiceover-display');
    
    let activeElements = [];
    let animationFrame;
    let timeouts = [];
    let intervals = [];
    let isPlaying = false;

    // --- Timeline Definition (Slower, More Readable, LARGER FONT) ---
    const TOTAL_DURATION = 180; // 3 minutes in seconds

    const timeline = [
        // SECTION 1: TITLE (0-12s)
        { 
            time: 0.5, 
            type: 'text', 
            id: 'title1', 
            text: 'How to Calculate', 
            x: 800, y: 280, 
            fontSize: 110, 
            anchor: 'middle', 
            weight: 'bold', 
            duration: 2.5,
            voiceover: 'Welcome! Today we will learn how to calculate voltage drop.'
        },
        { 
            time: 3.5, 
            type: 'text', 
            id: 'title2', 
            text: 'VOLTAGE DROP', 
            x: 800, y: 420, 
            fontSize: 130, 
            anchor: 'middle', 
            weight: 'bold',
            fill: 'var(--primary-blue)',
            duration: 3,
            voiceover: 'This is a critical skill for electrical engineers and designers.'
        },
        { 
            time: 7, 
            type: 'text', 
            id: 'subtitle', 
            text: 'A Step-by-Step Professional Guide', 
            x: 800, y: 540, 
            fontSize: 66, 
            anchor: 'middle',
            duration: 2.5,
            voiceover: 'Let me guide you through this step by step.'
        },
        { 
            time: 10, 
            type: 'path', 
            id: 'title-underline', 
            d: 'M 200 570 H 1400', 
            stroke: 'var(--primary-blue)', 
            strokeWidth: 6,
            duration: 1.5,
            voiceover: ''
        },
        
        // CLEAR AND NEW SECTION
        { time: 13, type: 'clear', voiceover: 'First, let me show you the master formula.' },
        
        // SECTION 2: THE FORMULA (14-35s)
        { 
            time: 14, 
            type: 'text', 
            id: 'formula-heading', 
            text: 'The Master Formula (IEC Standard)', 
            x: 800, y: 100, 
            fontSize: 84, 
            weight: 'bold', 
            anchor: 'middle',
            duration: 3,
            voiceover: 'This is the internationally accepted IEC formula for voltage drop calculation.'
        },
        { 
            time: 18, 
            type: 'rect', 
            id: 'formula-box', 
            x: 100, y: 180, 
            width: 1400, 
            height: 140,
            stroke: 'var(--primary-blue)', 
            strokeWidth: 5, 
            fill: 'rgba(0, 86, 179, 0.05)',
            duration: 1,
            voiceover: ''
        },
        { 
            time: 19.5, 
            type: 'text', 
            id: 'formula', 
            text: 'VD = K × I × L × [R·cos(φ) + X·sin(φ)]', 
            x: 800, y: 275, 
            fontSize: 78, 
            anchor: 'middle',
            fill: 'var(--draw-color)',
            weight: 'bold',
            duration: 4,
            voiceover: 'Voltage Drop equals K times Current times Length times Impedance.'
        },
        { 
            time: 25, 
            type: 'text', 
            id: 'k-label', 
            text: '• K = Constant', 
            x: 150, y: 400, 
            fontSize: 66,
            duration: 2,
            voiceover: 'K is a constant that depends on the system type.'
        },
        { 
            time: 27.5, 
            type: 'text', 
            id: 'k-value', 
            text: '  (√3 ≈ 1.732 for 3-phase, 2 for single-phase)', 
            x: 200, y: 470, 
            fontSize: 58,
            fill: '#555',
            duration: 3,
            voiceover: 'Root 3, or 1.732, for three-phase systems, and 2 for single-phase.'
        },
        { 
            time: 31.5, 
            type: 'text', 
            id: 'i-label', 
            text: '• I = Load Current (Amperes)', 
            x: 150, y: 550, 
            fontSize: 66,
            duration: 2.5,
            voiceover: 'I is the load current in amperes.'
        },
        { 
            time: 35, 
            type: 'text', 
            id: 'l-label', 
            text: '• L = Cable Length (kilometers)', 
            x: 150, y: 630, 
            fontSize: 66,
            duration: 2.5,
            voiceover: 'L is the one-way cable length in kilometers.'
        },
        { 
            time: 38.5, 
            type: 'text', 
            id: 'z-label', 
            text: '• [R·cos(φ) + X·sin(φ)] = Impedance Effect', 
            x: 150, y: 710, 
            fontSize: 66,
            duration: 3,
            voiceover: 'This part represents the impedance effect on voltage drop.'
        },
        { 
            time: 42, 
            type: 'text', 
            id: 'z-note', 
            text: '  R and X values come from cable tables', 
            x: 200, y: 780, 
            fontSize: 58,
            fill: '#555',
            duration: 3,
            voiceover: 'R is resistance, X is reactance. Both come from manufacturer tables.'
        },

        // CLEAR
        { time: 46, type: 'clear', voiceover: 'Now, let\'s solve a practical example together!' },

        // SECTION 3: EXAMPLE SETUP (47-65s)
        { 
            time: 47, 
            type: 'text', 
            id: 'example-title', 
            text: 'Practical Example', 
            x: 800, y: 90, 
            fontSize: 90, 
            weight: 'bold', 
            anchor: 'middle',
            fill: 'var(--success-green)',
            duration: 2.5,
            voiceover: 'Here\'s a real-world problem we need to solve.'
        },
        { 
            time: 50.5, 
            type: 'text', 
            id: 'given-title', 
            text: 'Given Data:', 
            x: 150, y: 180, 
            fontSize: 72, 
            weight: 'bold',
            duration: 1.5,
            voiceover: 'These are the given parameters.'
        },
        { 
            time: 53, 
            type: 'text', 
            id: 'given1', 
            text: '• System Voltage = 400V (3-Phase)', 
            x: 200, y: 260, 
            fontSize: 62,
            duration: 3,
            voiceover: 'A 400-volt, three-phase system.'
        },
        { 
            time: 56.5, 
            type: 'text', 
            id: 'given2', 
            text: '• Load Current (I) = 100 Amperes', 
            x: 200, y: 330, 
            fontSize: 62,
            duration: 2.5,
            voiceover: 'The load draws 100 amperes of current.'
        },
        { 
            time: 59.5, 
            type: 'text', 
            id: 'given3', 
            text: '• Cable Length (L) = 150 meters = 0.15 km', 
            x: 200, y: 400, 
            fontSize: 62,
            duration: 3,
            voiceover: 'Cable length is 150 meters, or 0.15 kilometers.'
        },
        { 
            time: 63, 
            type: 'text', 
            id: 'given4', 
            text: '• Power Factor (cos φ) = 0.85', 
            x: 200, y: 470, 
            fontSize: 62,
            duration: 2.5,
            voiceover: 'Power factor is 0.85.'
        },
        { 
            time: 66, 
            type: 'text', 
            id: 'given5', 
            text: '• Cable Type: 70 mm² Copper', 
            x: 200, y: 540, 
            fontSize: 62,
            duration: 2.5,
            voiceover: 'We\'re using a 70 square millimeter copper cable.'
        },
        { 
            time: 69, 
            type: 'text', 
            id: 'cable-data-title', 
            text: 'From Standard Cable Tables:', 
            x: 200, y: 630, 
            fontSize: 66, 
            weight: 'bold',
            fill: 'var(--primary-blue)',
            duration: 2.5,
            voiceover: 'Looking at standard cable tables for 70mm² copper:'
        },
        { 
            time: 72, 
            type: 'text', 
            id: 'cable-r', 
            text: '• Resistance (R) = 0.33 Ω/km', 
            x: 250, y: 710, 
            fontSize: 62,
            duration: 2.5,
            voiceover: 'Resistance is 0.33 ohms per kilometer.'
        },
        { 
            time: 75, 
            type: 'text', 
            id: 'cable-x', 
            text: '• Reactance (X) = 0.075 Ω/km', 
            x: 250, y: 780, 
            fontSize: 62,
            duration: 2.5,
            voiceover: 'Reactance is 0.075 ohms per kilometer.'
        },

        // CLEAR
        { time: 79, type: 'clear', voiceover: 'Step 1: Calculate sine of phi.' },

        // SECTION 4: CALCULATIONS (80-125s)
        { 
            time: 80, 
            type: 'text', 
            id: 'step1-title', 
            text: 'Step 1: Find sin(φ)', 
            x: 
            voiceover: 'X times sine phi equals 0.075 times 0.527, which is 0.0395.'
        },
        { 
            time: 103, 
            type: 'text', 
            id: 'step2-result', 
            text: 'Total = 0.2805 + 0.0395 = 0.32 Ω/km', 
            x: 200, y: 765, 
            fontSize: 66,
            weight: 'bold',
            fill: 'var(--success-green)',
            duration: 3,
            voiceover: 'Adding them together gives us 0.32 ohms per kilometer.'
        },

        // CLEAR
        { time: 107, type: 'clear', voiceover: 'Step 3: Apply the main formula.' },

        { 
            time: 108, 
            type: 'text', 
            id: 'step3-title', 
            text: 'Step 3: Apply the Formula', 
            x: 800, y: 120, 
            fontSize: 84, 
            weight: 'bold',
            anchor: 'middle',
            fill: 'var(--danger-red)',
            duration: 2.5,
            voiceover: 'Now we apply the complete formula.'
        },
        { 
            time: 111, 
            type: 'text', 
            id: 'formula-reminder', 
            text: 'VD = K × I × L × [R·cos(φ) + X·sin(φ)]', 
            x: 800, y: 220, 
            fontSize: 62, 
            anchor: 'middle',
            fill: '#555',
            duration: 3,
            voiceover: 'Remember our formula.'
        },
        { 
            time: 115, 
            type: 'text', 
            id: 'substitution', 
            text: 'Substituting Values:', 
            x: 150, y: 320, 
            fontSize: 70, 
            weight: 'bold',
            duration: 2,
            voiceover: 'Let\'s substitute all our values.'
        },
        { 
            time: 117.5, 
            type: 'text', 
            id: 'calc-line1', 
            text: 'VD = 1.732 × 100A × 0.15km × 0.32 Ω/km', 
            x: 200, y: 420, 
            fontSize: 62,
            duration: 4,
            voiceover: 'VD equals 1.732 times 100 amperes times 0.15 kilometers times 0.32 ohms per kilometer.'
        },
        { 
            time: 122, 
            type: 'text', 
            id: 'calc-line2', 
            text: 'VD = 1.732 × 100 × 0.15 × 0.32', 
            x: 200, y: 500, 
            fontSize: 62,
            duration: 3,
            voiceover: 'Simplifying the calculation.'
        },
        { 
            time: 125.5, 
            type: 'text', 
            id: 'calc-line3', 
            text: 'VD = 8.31 Volts', 
            x: 200, y: 620, 
            fontSize: 90,
            weight: 'bold',
            fill: 'var(--success-green)',
            duration: 2.5,
            voiceover: 'The voltage drop is 8.31 volts!'
        },
        { 
            time: 128.5, 
            type: 'rect', 
            id: 'result-box', 
            x: 150, y: 560, 
            width: 700, 
            height: 120,
            stroke: 'var(--success-green)', 
            strokeWidth: 6, 
            fill: 'rgba(40, 167, 69, 0.1)',
            duration: 1,
            voiceover: ''
        },

        // CLEAR
        { time: 131, type: 'clear', voiceover: 'But we must check if this is acceptable!' },

        // SECTION 5: PERCENTAGE CHECK (132-155s)
        { 
            time: 132, 
            type: 'text', 
            id: 'check-title', 
            text: 'Critical Step: Percentage Check', 
            x: 800, y: 130, 
            fontSize: 84, 
            weight: 'bold',
            anchor: 'middle',
            fill: 'var(--warning-orange)',
            duration: 3,
            voiceover: 'This is critical! We must check the percentage voltage drop.'
        },
        { 
            time: 136, 
            type: 'text', 
            id: 'percent-formula', 
            text: '% VD = (Voltage Drop / System Voltage) × 100', 
            x: 800, y: 260, 
            fontSize: 66,
            ', 
            x: 500, y: 440, 
            width: 600, 
            height: 130,
            middle',
            weight: 'bold',
            fill: 'var(--success-green)',
            duration: 3,
            voiceover: 'Yes! It\'s well within the standard limit of 3 to 5 percent. Excellent!'
        },

        // CLEAR
        { time: 158, type: 'clear', voiceover: 'Let me summarize what we learned today.' },

        // SECTION 6: CONCLUSION (159-180s)
        { 
            time: 159, 
            type: 'text', 
            id: 'summary-title', 
            text: 'Summary', 
            x: 800, y: 110, 
            fontSize: 90, 
            weight: 'bold',
            
            
            el.id = item.id;
            svg.appendChild(el);
        }
        
        return el;
    }

    // --
        el.style.opacity = 1;

        function addNextChar() {
            if(charIndex < chars.length && isPlaying) {
                el.textContent += chars[charIndex];
                charIndex++;
                const timeout = setTimeout(addNextChar, actualDelay);
                timeouts.push(timeout);
            }
        }

        addNextChar();
    }

    // --- Draw Animation for Paths/Rects ---
    function drawShape(el, duration) {
        el.style.opacity = 1;
        el.classList.add('fade-in');
    }

    // --- Main Animation Function ---
    function animateItem(item) {
        if (item.type === 'clear') {
            // Clear the board
            activeElements.forEach(el => {
                if(el && el.parentNode) {
                    svg.removeChild(el);
                }
            });
            activeElements = [];
            if(item.voiceover) showVoiceover(item.voiceover);
            return;
        }

        // Show voiceover
        if(item.voiceover) {
            showVoiceover(item.voiceover);
        }

        // Create and animate element
        const el = createElement(item);
        if(!el) return;
        
        activeElements.push(el);

        if(item.type === 'text') {
            const text = el.getAttribute('data-text');
            typeText(el, text, item.duration);
        } else {
            drawShape(el, item.duration);
        }
    }

    // --- Start Animation ---
    function startAnimation() {
        if(isPlaying) return;
        
        resetAnimation();
        isPlaying = true;
        playBtn.disabled = true;
        playBtn.textContent = '▶ Playing...';
        
        const startTime = Date.now();

        // Schedule all timeline items
        timeline.forEach(item => {
            const timeout = setTimeout(() => {
                if(isPlaying) {
                    animateItem(item);
                }
            }, item.time * 1000);
            timeouts.push(timeout);
        });

        // Animation loop for progress bar
        function updateProgress() {
            if(!isPlaying) return;
            
            const elapsed = (Date.now() - startTime) / 1000;
            
            if(elapsed >= TOTAL_DURATION) {
                progressBar.style.width = '100%';
                const timeout = setTimeout(() => {
                    resetAnimation();
                    voDisplay.textContent = 'Tutorial complete! Click to replay.';
                }, 1000);
                timeouts.push(timeout);
                return;
            }
            
            updateUI(elapsed);
            animationFrame = requestAnimationFrame(updateProgress);
        }
        
        updateProgress();
    }

    // --- Event Listeners ---
    playBtn.addEventListener('click', startAnimation);

    // Cleanup on page unload
    window.addEventListener('beforeunload', resetAnimation);
</script>

</body>

</html>
