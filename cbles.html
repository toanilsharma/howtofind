<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Cable Sizing - A Professional Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --board-bg: #f8f9fa;
            --draw-color: #1a1a1a;
            --primary-blue: #0056b3;
            --danger-red: #dc3545;
            --success-green: #28a745;
            --warning-orange: #fd7e14;
            --font-main: 'Kalam', cursive;
            --font-alt: 'Architects Daughter', cursive;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            font-family: var(--font-main);
        }

        #whiteboard-container {
            position: relative;
            width: 95vw;
            max-width: 1600px;
            aspect-ratio: 16 / 9;
        }

        #whiteboard {
            width: 100%;
            height: 100%;
            background-color: var(--board-bg);
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border: 20px solid #8b7355;
            border-bottom-width: 60px;
        }

        #animation-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .anim-element {
            opacity: 0;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .visible {
            opacity: 1;
        }

        .text-anim {
            font-family: var(--font-main);
        }

        #controls {
            position: absolute;
            top: -70px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        #play-btn {
            font-family: sans-serif;
            font-weight: bold;
            font-size: 20px;
            padding: 15px 40px;
            cursor: pointer;
            border: 3px solid var(--primary-blue);
            background-color: #fff;
            color: var(--primary-blue);
            border-radius: 8px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        #play-btn:hover { 
            background-color: var(--primary-blue); 
            color: #fff;
            transform: scale(1.05);
        }

        #play-btn:disabled { 
            cursor: not-allowed; 
            opacity: 0.6;
            transform: scale(1);
        }

        #voiceover-display {
            position: absolute;
            bottom: -80px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.8vw;
            line-height: 1.5;
            color: #ecf0f1;
            padding: 10px 20px;
            font-family: var(--font-alt);
            background: rgba(44, 62, 80, 0.9);
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #progress-bar-container {
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 0 0 4px 4px;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 0 0 4px 4px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="whiteboard-container">
        <div id="controls">
            <button id="play-btn">▶ Start Tutorial</button>
        </div>
        <div id="whiteboard">
            <svg id="animation-svg" viewBox="0 0 1600 900">
                <!-- All SVG elements will be dynamically created by JavaScript -->
            </svg>
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
        </div>
        <div id="voiceover-display">Click "Start Tutorial" to begin...</div>
    </div>

<script>
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.getElementById('animation-svg');
    const playBtn = document.getElementById('play-btn');
    const progressBar = document.getElementById('progress-bar');
    const voDisplay = document.getElementById('voiceover-display');
    
    let activeElements = [];
    let animationFrame;
    let timeouts = [];
    let intervals = [];
    let isPlaying = false;

    // --- Timeline Definition ---
    const TOTAL_DURATION = 190; // in seconds

    const timeline = [
        // SECTION 1: TITLE (0-14s)
        { 
            time: 0.5, type: 'text', id: 'title1', text: 'How to Select', 
            x: 800, y: 280, fontSize: 110, anchor: 'middle', weight: 'bold', duration: 2.5,
            voiceover: 'Welcome! Today, we will master the professional method for selecting the perfect industrial cable size.'
        },
        { 
            time: 3.5, type: 'text', id: 'title2', text: 'The PERFECT CABLE SIZE', 
            x: 800, y: 420, fontSize: 120, anchor: 'middle', weight: 'bold',
            fill: 'var(--primary-blue)', duration: 3.5,
            voiceover: 'This is one of the most important tasks for an electrical engineer.'
        },
        { 
            time: 7.5, type: 'text', id: 'subtitle', text: 'For Industrial Applications', 
            x: 800, y: 540, fontSize: 66, anchor: 'middle', duration: 3,
            voiceover: 'Our focus today is on robust industrial applications.'
        },
        { 
            time: 11, type: 'path', id: 'title-underline', d: 'M 200 570 H 1400', 
            stroke: 'var(--primary-blue)', strokeWidth: 6, duration: 1.5,
            voiceover: ''
        },
        
        { time: 14, type: 'clear', voiceover: 'Cable sizing is based on three critical checks.' },
        
        // SECTION 2: THE CORE PRINCIPLES (15-45s)
        { 
            time: 15, type: 'text', id: 'principles-heading', text: 'The 3 Critical Checks', 
            x: 800, y: 120, fontSize: 90, weight: 'bold', anchor: 'middle', duration: 3,
            voiceover: 'We must satisfy all three of these conditions.'
        },
        { 
            time: 19, type: 'rect', id: 'box1', x: 100, y: 200, width: 1400, height: 160,
            stroke: 'var(--draw-color)', strokeWidth: 4, fill: 'rgba(0,0,0,0.02)', duration: 1,
            voiceover: ''
        },
        { 
            time: 20, type: 'text', id: 'check1', text: '1. Current Carrying Capacity (Ampacity)', 
            x: 150, y: 300, fontSize: 68, weight: 'bold', duration: 4,
            voiceover: 'First, the cable must safely carry the load current without overheating.'
        },
        { 
            time: 25, type: 'rect', id: 'box2', x: 100, y: 400, width: 1400, height: 160,
            stroke: 'var(--draw-color)', strokeWidth: 4, fill: 'rgba(0,0,0,0.02)', duration: 1,
            voiceover: ''
        },
        { 
            time: 26, type: 'text', id: 'check2', text: '2. Voltage Drop Limit', 
            x: 150, y: 500, fontSize: 68, weight: 'bold', duration: 4,
            voiceover: 'Second, the voltage drop must be within acceptable limits to ensure equipment runs correctly.'
        },
        { 
            time: 31, type: 'rect', id: 'box3', x: 100, y: 600, width: 1400, height: 160,
            stroke: 'var(--draw-color)', strokeWidth: 4, fill: 'rgba(0,0,0,0.02)', duration: 1,
            voiceover: ''
        },
        { 
            time: 32, type: 'text', id: 'check3', text: '3. Short Circuit Withstand', 
            x: 150, y: 700, fontSize: 68, weight: 'bold', duration: 4,
            voiceover: 'And third, the cable must survive a short circuit fault long enough for protection to operate. This is for safety.'
        },

        { time: 40, type: 'clear', voiceover: 'Let\'s apply these checks to a real-world example.' },

        // SECTION 3: EXAMPLE SETUP (41-75s)
        { 
            time: 41, type: 'text', id: 'example-title', text: 'Example: Sizing a Motor Feeder', 
            x: 800, y: 90, fontSize: 84, weight: 'bold', anchor: 'middle', fill: 'var(--success-green)',
            duration: 3, voiceover: 'We need to size a cable for a large industrial motor.'
        },
        { 
            time: 45, type: 'text', id: 'given-title', text: 'Given Data:', 
            x: 150, y: 170, fontSize: 68, weight: 'bold', duration: 2,
            voiceover: 'Here are the project specifications.'
        },
        { 
            time: 48, type: 'text', id: 'given1', text: '• Motor: 55 kW, 400V, 3-Phase, PF=0.88',
            x: 200, y: 240, fontSize: 58, duration: 3,
            voiceover: 'A 55 kilowatt, 400 volt, three-phase motor with a power factor of 0.88.'
        },
        { 
            time: 51.5, type: 'text', id: 'given2', text: '• Full Load Current (FLC) = 99 Amperes',
            x: 200, y: 310, fontSize: 58, duration: 3,
            voiceover: 'The calculated full load current is 99 amps.'
        },
        { 
            time: 55, type: 'text', id: 'given3', text: '• Cable Length = 80 meters',
            x: 200, y: 380, fontSize: 58, duration: 2.5,
            voiceover: 'The cable run is 80 meters long.'
        },
        { 
            time: 58, type: 'text', id: 'given4', text: '• Installation: On tray with 2 other cables',
            x: 200, y: 450, fontSize: 58, duration: 3,
            voiceover: 'It is installed on a cable tray, grouped with two other cables.'
        },
        { 
            time: 61.5, type: 'text', id: 'given5', text: '• Ambient Temperature = 45°C',
            x: 200, y: 520, fontSize: 58, duration: 2.5,
            voiceover: 'The ambient air temperature is 45 degrees Celsius.'
        },
        { 
            time: 64.5, type: 'text', id: 'given6', text: '• Fault Level = 15 kA for 1 second',
            x: 200, y: 590, fontSize: 58, duration: 3,
            voiceover: 'And the system fault level is 15 kilo-amps for one second.'
        },
        { 
            time: 68, type: 'text', id: 'derating-title', text: 'Derating Factors (from IEC tables):',
            x: 150, y: 680, fontSize: 68, weight: 'bold', fill: 'var(--primary-blue)', duration: 3,
            voiceover: 'Now, we find the derating factors from standard IEC tables.'
        },
        { 
            time: 71.5, type: 'text', id: 'derating1', text: 'Grouping (Cg) = 0.88 | Temp (Ct) = 0.91',
            x: 200, y: 760, fontSize: 58, duration: 3.5,
            voiceover: 'For three cables on a tray, the grouping factor is 0.88. For 45 degrees, the temperature factor is 0.91.'
        },

        { time: 76, type: 'clear', voiceover: 'Let\'s start with the first check: Ampacity.' },

        // SECTION 4: AMPACITY CALCULATION (77-105s)
        { 
            time: 77, type: 'text', id: 'step1-title', text: 'Step 1: Required Ampacity', 
            x: 800, y: 110, fontSize: 84, weight: 'bold', anchor: 'middle', fill: 'var(--danger-red)',
            duration: 3, voiceover: 'First, we must calculate the required current rating, including derating factors.'
        },
        { 
            time: 81, type: 'text', id: 'step1-formula', text: 'I_required = FLC / (Cg × Ct)',
            x: 800, y: 240, fontSize: 72, anchor: 'middle', duration: 4,
            voiceover: 'The required rating is the Full Load Current divided by the product of all derating factors.'
        },
        { 
            time: 86, type: 'text', id: 'step1-calc1', text: 'I_required = 99 / (0.88 × 0.91)',
            x: 800, y: 360, fontSize: 72, anchor: 'middle', duration: 4,
            voiceover: 'So, 99 amps divided by 0.88 times 0.91.'
        },
        { 
            time: 91, type: 'text', id: 'step1-calc2', text: 'I_required = 99 / 0.80 = 123.75 Amps',
            x: 800, y: 480, fontSize: 72, anchor: 'middle', duration: 4,
            voiceover: 'This gives us a required minimum current rating of 123.75 Amperes.'
        },
        { 
            time: 96, type: 'text', id: 'step1-selection', text: 'We need a cable that can handle > 124A.',
            x: 800, y: 600, fontSize: 62, anchor: 'middle', duration: 3,
            voiceover: 'We must select a cable size that can handle at least 124 amps *after* derating.'
        },
        { 
            time: 100, type: 'text', id: 'step1-result', text: 'Initial Selection: 50mm² Copper XLPE (rated ~151A)',
            x: 800, y: 720, fontSize: 68, anchor: 'middle', weight: 'bold', fill: 'var(--success-green)',
            duration: 5, voiceover: 'Looking at IEC tables, a 50 square millimeter copper cable has a rating of 151 amps. This is our initial selection.'
        },
        { 
            time: 101, type: 'rect', id: 'step1-box', x: 200, y: 660, width: 1200, height: 110,
            stroke: 'var(--success-green)', strokeWidth: 5, fill: 'rgba(40, 167, 69, 0.1)',
            duration: 1, voiceover: ''
        },
        
        { time: 106, type: 'clear', voiceover: 'Now, let\'s check this 50mm² cable for voltage drop.' },

        // SECTION 5: VOLTAGE DROP (107-130s)
        { 
            time: 107, type: 'text', id: 'step2-title', text: 'Step 2: Voltage Drop Check (for 50mm²)', 
            x: 800, y: 110, fontSize: 78, weight: 'bold', anchor: 'middle', fill: 'var(--danger-red)',
            duration: 3, voiceover: 'Now we perform the voltage drop calculation for our selected 50mm² cable.'
        },
        { 
            time: 111, type: 'text', id: 'step2-formula', text: 'VD = 1.732 × I × L × [R·cos(φ) + X·sin(φ)]',
            x: 800, y: 220, fontSize: 58, anchor: 'middle', duration: 4,
            voiceover: 'We use the standard IEC formula. For 50mm² copper, R is 0.49 and X is 0.08 Ohms per kilometer.'
        },
        { 
            time: 116, type: 'text', id: 'step2-calc1', text: 'VD = 1.732 × 99A × 0.08km × (0.49×0.88 + 0.08×0.475)',
            x: 800, y: 330, fontSize: 58, anchor: 'middle', duration: 5,
            voiceover: 'Plugging in our values: 1.732, times 99 amps, times 0.08 kilometers, and the impedance term.'
        },
        { 
            time: 122, type: 'text', id: 'step2-calc2', text: 'VD = 13.72 × (0.431 + 0.038) = 6.44 Volts',
            x: 800, y: 440, fontSize: 68, anchor: 'middle', duration: 4,
            voiceover: 'The calculation gives us a voltage drop of 6.44 Volts.'
        },
        { 
            time: 127, type: 'text', id: 'step2-percent', text: '%VD = (6.44V / 400V) × 100 = 1.61%',
            x: 800, y: 570, fontSize: 78, anchor: 'middle', weight: 'bold',
            fill: 'var(--success-green)', duration: 4,
            voiceover: 'As a percentage, this is only 1.61 percent.'
        },
        { 
            time: 132, type: 'text', id: 'step2-ok', text: 'This is < 5% limit, so it is ACCEPTABLE ✓',
            x: 800, y: 690, fontSize: 68, anchor: 'middle', weight: 'bold',
            fill: 'var(--success-green)', duration: 3,
            voiceover: 'This is well below the typical 5 percent limit, so our cable passes the voltage drop test.'
        },

        { time: 136, type: 'clear', voiceover: 'Finally, the most critical safety check: short circuit withstand.' },

        // SECTION 6: SHORT CIRCUIT (137-165s)
        { 
            time: 137, type: 'text', id: 'step3-title', text: 'Step 3: Short Circuit Check', 
            x: 800, y: 110, fontSize: 84, weight: 'bold', anchor: 'middle', fill: 'var(--warning-orange)',
            duration: 3, voiceover: 'Can our 50mm² cable survive a 15 kilo-amp fault for one second?'
        },
        { 
            time: 141, type: 'text', id: 'step3-formula', text: 'S_min = (I_fault × √t) / K',
            x: 800, y: 240, fontSize: 72, anchor: 'middle', duration: 4,
            voiceover: 'We use the adiabatic formula, where S is the minimum required cross-section.'
        },
        { 
            time: 146, type: 'text', id: 'step3-k', text: 'K is a material constant (~143 for Copper XLPE)',
            x: 800, y: 340, fontSize: 58, anchor: 'middle', fill: '#555', duration: 3,
            voiceover: 'K is a constant based on the conductor and insulation. For XLPE insulated copper, it is 143.'
        },
        { 
            time: 150, type: 'text', id: 'step3-calc', text: 'S_min = (15,000A × √1s) / 143',
            x: 800, y: 460, fontSize: 72, anchor: 'middle', duration: 4,
            voiceover: 'Plugging in our fault values: 15,000 amps for 1 second.'
        },
        { 
            time: 155, type: 'text', id: 'step3-result', text: 'S_min = 104.9 mm²',
            x: 800, y: 600, fontSize: 108, anchor: 'middle', weight: 'bold',
            fill: 'var(--danger-red)', duration: 3,
            voiceover: 'This means we need a cable of at least 105 square millimeters.'
        },
        { 
            time: 159, type: 'text', id: 'step3-fail', text: 'Our 50mm² cable FAILS this check! ✗',
            x: 800, y: 730, fontSize: 72, anchor: 'middle', weight: 'bold',
            fill: 'var(--danger-red)', duration: 4,
            voiceover: 'Our initially selected 50mm² cable is not safe! It would be destroyed in a fault.'
        },
        { 
            time: 160, type: 'rect', id: 'step3-box', x: 250, y: 530, width: 1100, height: 130,
            stroke: 'var(--danger-red)', strokeWidth: 6, fill: 'rgba(220, 53, 69, 0.1)',
            duration: 1, voiceover: ''
        },

        { time: 165, type: 'clear', voiceover: 'We must upsize our cable and make our final selection.' },

        // SECTION 7: CONCLUSION (166-190s)
        { 
            time: 166, type: 'text', id: 'final-title', text: 'Final Selection & Summary', 
            x: 800, y: 110, fontSize: 90, weight: 'bold', anchor: 'middle', fill: 'var(--primary-blue)',
            duration: 3, voiceover: 'Based on the critical short circuit check, we revise our selection.'
        },
        { 
            time: 170, type: 'text', id: 'final-text1', text: 'The short circuit check requires ≥ 105mm².',
            x: 800, y: 230, fontSize: 62, anchor: 'middle', duration: 3,
            voiceover: 'The short circuit calculation is the deciding factor in this case.'
        },
        { 
            time: 174, type: 'text', id: 'final-text2', text: 'The next standard size is 120mm².',
            x: 800, y: 320, fontSize: 62, anchor: 'middle', duration: 3,
            voiceover: 'We choose the next available standard cable size, which is 120 square millimeters.'
        },
        { 
            time: 178, type: 'text', id: 'final-answer', text: 'Final Cable: 120mm² Copper XLPE',
            x: 800, y: 450, fontSize: 84, anchor: 'middle', weight: 'bold',
            fill: 'var(--success-green)', duration: 4,
            voiceover: 'This cable satisfies all three checks: ampacity, voltage drop, and short circuit safety.'
        },
        { 
            time: 179, type: 'rect', id: 'final-box', x: 200, y: 390, width: 1200, height: 110,
            stroke: 'var(--success-green)', strokeWidth: 6, fill: 'rgba(40, 167, 69, 0.1)',
            duration: 1, voiceover: ''
        },
        { 
            time: 183, type: 'text', id: 'sum-text', text: 'Always perform all 3 checks!',
            x: 800, y: 600, fontSize: 72, anchor: 'middle', duration: 3,
            voiceover: 'Remember to always perform all three critical checks for a safe and reliable design.'
        },
        { 
            time: 187, type: 'text', id: 'website-text', text: 'For more, visit: https://designcalculators.co.in',
            x: 800, y: 750, fontSize: 58, anchor: 'middle', weight: 'bold', fill: 'var(--primary-blue)',
            duration: 3, voiceover: 'Thank you for learning with us today!'
        },
    ];

    // --- Helper Functions ---
    function resetAnimation() {
        // Clear all timeouts and intervals
        timeouts.forEach(t => clearTimeout(t));
        intervals.forEach(i => clearInterval(i));
        timeouts = [];
        intervals = [];
        
        if (animationFrame) {
            cancelAnimationFrame(animationFrame);
        }

        // Remove all elements
        while(svg.firstChild) {
            svg.removeChild(svg.firstChild);
        }
        
        activeElements = [];
        progressBar.style.width = '0%';
        voDisplay.textContent = 'Click "Start Tutorial" to begin...';
        playBtn.disabled = false;
        playBtn.textContent = '▶ Start Tutorial';
        isPlaying = false;
    }

    function updateUI(elapsedSeconds) {
        const percentage = (elapsedSeconds / TOTAL_DURATION) * 100;
        progressBar.style.width = percentage + '%';
    }

    function showVoiceover(text) {
        if(text && text.trim() !== '') {
            voDisplay.textContent = text;
        }
    }

    // --- Element Creation ---
    function createElement(item) {
        let el;
        
        if (item.type === 'text') {
            el = document.createElementNS(svgNS, 'text');
            el.setAttribute('x', item.x);
            el.setAttribute('y', item.y);
            el.setAttribute('font-size', item.fontSize);
            el.setAttribute('fill', item.fill || 'var(--draw-color)');
            if(item.anchor) el.setAttribute('text-anchor', item.anchor);
            if(item.weight) el.setAttribute('font-weight', item.weight);
            el.textContent = ''; // Start empty for typing effect
            el.setAttribute('data-text', item.text);
            el.classList.add('text-anim', 'anim-element');
            
        } else if (item.type === 'path') {
            el = document.createElementNS(svgNS, 'path');
            el.setAttribute('d', item.d);
            el.setAttribute('stroke', item.stroke || 'var(--draw-color)');
            el.setAttribute('stroke-width', item.strokeWidth || 4);
            el.setAttribute('fill', item.fill || 'none');
            el.classList.add('anim-element');
            
        } else if (item.type === 'rect') {
            el = document.createElementNS(svgNS, 'rect');
            el.setAttribute('x', item.x);
            el.setAttribute('y', item.y);
            el.setAttribute('width', item.width);
            el.setAttribute('height', item.height);
            el.setAttribute('stroke', item.stroke || 'var(--draw-color)');
            el.setAttribute('stroke-width', item.strokeWidth || 4);
            el.setAttribute('fill', item.fill || 'none');
            el.setAttribute('rx', item.rx || 10);
            el.classList.add('anim-element');
        }
        
        if(el) {
            el.id = item.id;
            svg.appendChild(el);
        }
        
        return el;
    }

    // --- Typing Animation (Human-like speed) ---
    function typeText(el, text, duration) {
        if(!text || text.length === 0) {
            el.style.opacity = 1;
            return;
        }

        let charIndex = 0;
        const chars = text.split('');
        const charDelay = (duration * 1000) / chars.length;
        // Ensure minimum delay for readability (50ms per character minimum)
        const actualDelay = Math.max(50, charDelay);

        el.style.opacity = 1;

        function addNextChar() {
            if(charIndex < chars.length && isPlaying) {
                el.textContent += chars[charIndex];
                charIndex++;
                const timeout = setTimeout(addNextChar, actualDelay);
                timeouts.push(timeout);
            }
        }

        addNextChar();
    }

    // --- Draw Animation for Paths/Rects ---
    function drawShape(el, duration) {
        el.style.opacity = 1;
        el.style.animationDuration = (duration > 1 ? 1 : duration) + 's';
        el.classList.add('fade-in');
    }

    // --- Main Animation Function ---
    function animateItem(item) {
        if (item.type === 'clear') {
            // Clear the board
            activeElements.forEach(el => {
                if(el && el.parentNode) {
                    svg.removeChild(el);
                }
            });
            activeElements = [];
            if(item.voiceover) showVoiceover(item.voiceover);
            return;
        }

        // Show voiceover
        if(item.voiceover) {
            showVoiceover(item.voiceover);
        }

        // Create and animate element
        const el = createElement(item);
        if(!el) return;
        
        activeElements.push(el);

        if(item.type === 'text') {
            const text = el.getAttribute('data-text');
            typeText(el, text, item.duration);
        } else {
            drawShape(el, item.duration);
        }
    }

    // --- Start Animation ---
    function startAnimation() {
        if(isPlaying) return;
        
        resetAnimation();
        isPlaying = true;
        playBtn.disabled = true;
        playBtn.textContent = '▶ Playing...';
        
        const startTime = Date.now();

        // Schedule all timeline items
        timeline.forEach(item => {
            const timeout = setTimeout(() => {
                if(isPlaying) {
                    animateItem(item);
                }
            }, item.time * 1000);
            timeouts.push(timeout);
        });

        // Animation loop for progress bar
        function updateProgress() {
            if(!isPlaying) return;
            
            const elapsed = (Date.now() - startTime) / 1000;
            
            if(elapsed >= TOTAL_DURATION) {
                progressBar.style.width = '100%';
                const timeout = setTimeout(() => {
                    resetAnimation();
                    voDisplay.textContent = 'Tutorial complete! Click to replay.';
                }, 2000);
                timeouts.push(timeout);
                return;
            }
            
            updateUI(elapsed);
            animationFrame = requestAnimationFrame(updateProgress);
        }
        
        updateProgress();
    }

    // --- Event Listeners ---
    playBtn.addEventListener('click', startAnimation);

    // Cleanup on page unload
    window.addEventListener('beforeunload', resetAnimation);
</script>

</body>
</html>
